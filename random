# Load data
df_salesforce = pd.read_excel('Data/Closed_Won Reasons/Closed_Won_Product_Capability.xlsx')

# Individual processing to remove empty or whitespace-only entries from each text column
df_salesforce['record_comment_text'] = df_salesforce['record_comment_text'].apply(lambda x: x.strip() if isinstance(x, str) else x)
df_salesforce['executive_summary_text'] = df_salesforce['executive_summary_text'].apply(lambda x: x.strip() if isinstance(x, str) else x)
df_salesforce['win_loss_comments_text'] = df_salesforce['win_loss_comments_text'].apply(lambda x: x.strip() if isinstance(x, str) else x)

# Exclude rows where any text field is empty after stripping whitespace
df_salesforce = df_salesforce.dropna(subset=['record_comment_text', 'executive_summary_text', 'win_loss_comments_text'], how='any')

# Concatenate text columns into a single string variable after individual processing
df_salesforce['combined_text'] = df_salesforce[['record_comment_text', 
                                                'executive_summary_text', 
                                                'win_loss_comments_text']].apply(lambda x: ' '.join(x), axis=1)

# Print counts
print(f"Total rows after excluding empty fields individually: {len(df_salesforce)}")
print(f"Sample of combined text: {df_salesforce['combined_text'].head()}")
